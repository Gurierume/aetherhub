<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Tokens - Ordem Paranormal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=JetBrains+Mono:wght@400;700&family=Share+Tech+Mono&display=swap');

        :root {
            --paranormal-red: #cc0000;
            --paranormal-red-glow: #ff0000;
            --ui-bg: #0a0a0c;
            --ui-panel: #121216;
            --ui-border: #2a2a32;
        }

        body {
            background-color: var(--ui-bg);
            color: #d1d1d1;
            font-family: 'JetBrains Mono', monospace;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 50% 50%, #16161d 0%, #0a0a0c 100%);
        }

        /* Efeito de Scanline de Monitor Antigo */
        .scanlines::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 100;
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
            opacity: 1;
        }

        /* Efeito de Cintilação (Flicker) */
        .flicker {
            animation: flicker 0.15s infinite;
        }
        @keyframes flicker {
            0% { opacity: 0.98; }
            50% { opacity: 1; }
            100% { opacity: 0.99; }
        }

        .fonte-rpg { font-family: 'Special Elite', cursive; }
        .fonte-tech { font-family: 'Share Tech Mono', monospace; }

        /* Janela Estilo OS */
        .os-window {
            background: var(--ui-panel);
            border: 1px solid var(--ui-border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-radius: 4px;
            position: relative;
            transition: box-shadow 0.3s ease;
        }

        .glow-active {
            box-shadow: 0 0 15px rgba(204, 0, 0, 0.15);
            border-color: #3a3a45;
        }

        .os-header {
            background: #1c1c24;
            border-bottom: 1px solid var(--ui-border);
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .os-dots { display: flex; gap: 6px; }
        .os-dot { width: 8px; height: 8px; border-radius: 50%; background: #333; }
        .os-dot.red { background: #ff5f56; }

        /* Container do Canvas */
        .token-canvas-container {
            position: relative;
            width: 550px;
            height: 550px;
            background-color: #000;
            border: 1px solid #333;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.9);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            max-width: 100%;
            height: auto;
            cursor: crosshair;
            filter: contrast(1.1) brightness(1.1);
        }

        .bg-grid {
            background-size: 40px 40px;
            background-image: 
                linear-gradient(to right, #1a1a1a 1px, transparent 1px),
                linear-gradient(to bottom, #1a1a1a 1px, transparent 1px);
        }

        /* Botões */
        .btn-action {
            background: transparent;
            border: 1px solid var(--ui-border);
            color: #888;
            padding: 10px;
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .btn-action:hover {
            border-color: var(--paranormal-red);
            color: white;
            background: rgba(204, 0, 0, 0.05);
        }

        .btn-primary {
            background: var(--paranormal-red);
            color: white;
            border: none;
            padding: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 15px rgba(204, 0, 0, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            background: #ff0000;
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.5);
            transform: scale(1.02);
        }

        /* Toggles Customizados */
        .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 18px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #222;
            transition: .4s;
            border-radius: 18px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 12px; width: 12px;
            left: 3px; bottom: 3px;
            background-color: #555;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--paranormal-red); }
        input:checked + .slider:before { transform: translateX(16px); background-color: white; }

        /* Scanner */
        .scanner {
            width: 100%; height: 2px;
            background: var(--paranormal-red);
            position: absolute; top: 0;
            box-shadow: 0 0 15px var(--paranormal-red);
            animation: scan 2s linear infinite;
        }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        .loading-overlay {
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(4px);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--ui-bg); }
        ::-webkit-scrollbar-thumb { background: var(--ui-border); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-12 scanlines flicker">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-10 flex flex-col md:flex-row justify-between items-end gap-4 border-l-4 border-red-700 pl-6">
            <div>
                <h1 class="text-3xl fonte-tech text-white uppercase tracking-widest leading-none">Terminal de Manifestação</h1>
                <p class="text-red-600 text-[10px] font-bold tracking-[0.5em] mt-2">SISTEMA LABIRINTHUS V4.2 // NÍVEL_ACESSO_ALFA</p>
            </div>
            <div class="text-right fonte-tech text-[10px] text-zinc-500">
                <p>STATUS: <span class="text-green-500">SINCRO_ESTÁVEL</span></p>
                <p id="systemClock">--:--:--</p>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Janela de Visualização (Esquerda) -->
            <div class="lg:col-span-7 space-y-4">
                <div class="os-window glow-active">
                    <div class="os-header">
                        <div class="os-dots">
                            <div class="os-dot red"></div>
                            <div class="os-dot"></div>
                            <div class="os-dot"></div>
                        </div>
                        <span class="text-[9px] uppercase font-bold text-zinc-500 tracking-tighter">Visualizador_Asset_01.exe</span>
                    </div>
                    
                    <div class="p-4 flex flex-col items-center bg-[#08080a]">
                        <div class="token-canvas-container bg-grid" id="canvasFrame">
                            <canvas id="tokenCanvas"></canvas>
                            <div id="loadingOverlay" class="loading-overlay absolute inset-0">
                                <div class="scanner"></div>
                                <div class="w-12 h-12 border-2 border-red-900 border-t-red-500 rounded-full animate-spin mb-4"></div>
                                <p class="fonte-tech text-red-500 text-xs tracking-widest animate-pulse">RECOMPILANDO ENTIDADE...</p>
                            </div>
                        </div>

                        <div class="w-full flex gap-2 mt-4">
                            <button id="removeBgBtn" class="btn-action flex-1">Expurgar Fundo</button>
                            <button id="downloadBtn" class="btn-action flex-1 text-white bg-zinc-800">Exportar Asset</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controlo e Definições (Direita) -->
            <div class="lg:col-span-5 space-y-6">
                <!-- Painel de Abas -->
                <div class="os-window glow-active">
                    <div class="os-header">
                        <div class="flex gap-4">
                            <button id="tabGen" class="text-[9px] uppercase font-bold text-white border-b-2 border-red-600 pb-1">Manifestação</button>
                            <button id="tabConfig" class="text-[9px] uppercase font-bold text-zinc-600 hover:text-zinc-400 pb-1 transition-colors">CRT_Config</button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <!-- Conteúdo Aba Geração -->
                        <div id="paneGen" class="space-y-6">
                            <div class="space-y-3">
                                <label class="text-[10px] font-bold uppercase text-red-500 tracking-widest">Prompt de Manifestação</label>
                                <textarea id="aiPrompt" rows="4" placeholder="Descreva a entidade..." class="w-full bg-[#08080a] border border-zinc-800 text-sm p-4 text-zinc-300 focus:outline-none focus:border-red-900 font-mono resize-none"></textarea>
                                <button id="generateBtn" class="w-full btn-primary text-xs py-4">Gerar Personagem</button>
                            </div>

                            <div class="grid grid-cols-2 gap-4 border-t border-zinc-800/50 pt-6">
                                <div class="space-y-2">
                                    <span class="text-[9px] uppercase text-zinc-500 font-bold block">Escala</span>
                                    <input type="range" id="zoomRange" min="0.1" max="4" step="0.01" value="1" class="w-full h-1 bg-zinc-800 appearance-none rounded accent-red-600">
                                </div>
                                <div class="space-y-2">
                                    <span class="text-[9px] uppercase text-zinc-500 font-bold block">Rotação</span>
                                    <input type="range" id="rotateRange" min="-180" max="180" step="1" value="0" class="w-full h-1 bg-zinc-800 appearance-none rounded accent-red-600">
                                </div>
                            </div>
                            
                            <div class="space-y-4 pt-4">
                                <input type="file" id="fileUpload" accept="image/*" class="text-[10px] text-zinc-600 w-full file:bg-zinc-900 file:border-0 file:text-zinc-500 file:px-3 file:py-1 cursor-pointer">
                            </div>
                        </div>

                        <!-- Conteúdo Aba Configuração -->
                        <div id="paneConfig" class="hidden space-y-6">
                            <h3 class="text-[11px] font-bold text-red-700 uppercase tracking-[0.3em] mb-4">Parâmetros Visuais do Monitor</h3>
                            
                            <div class="space-y-4">
                                <div class="flex justify-between items-center bg-black/30 p-3 rounded border border-zinc-900">
                                    <div>
                                        <p class="text-[10px] text-zinc-300 font-bold uppercase">Scanlines Overlay</p>
                                        <p class="text-[8px] text-zinc-600 uppercase">Linhas de processamento analógico</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="toggleScanlines" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="flex justify-between items-center bg-black/30 p-3 rounded border border-zinc-900">
                                    <div>
                                        <p class="text-[10px] text-zinc-300 font-bold uppercase">CRT Flicker</p>
                                        <p class="text-[8px] text-zinc-600 uppercase">Cintilação de frequência de rádio</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="toggleFlicker" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="flex justify-between items-center bg-black/30 p-3 rounded border border-zinc-900">
                                    <div>
                                        <p class="text-[10px] text-zinc-300 font-bold uppercase">Janelas Reativas</p>
                                        <p class="text-[8px] text-zinc-600 uppercase">Brilho paranormal nos painéis</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="toggleGlow" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="p-4 border border-red-900/20 bg-red-900/5 rounded">
                                <p class="fonte-tech text-[9px] text-red-800 uppercase leading-relaxed">
                                    Nota: Desativar 'Scanlines' melhora a performance em hardware legado.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Log Consola -->
                <div class="os-window p-4 fonte-tech text-[9px] text-zinc-600 bg-black/40">
                    <p>>>> SISTEMA INICIALIZADO...</p>
                    <p id="logStatus">>>> AGUARDANDO INPUT_BUFFER</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Gestão de Abas
        const tabGen = document.getElementById('tabGen');
        const tabConfig = document.getElementById('tabConfig');
        const paneGen = document.getElementById('paneGen');
        const paneConfig = document.getElementById('paneConfig');

        tabGen.onclick = () => {
            paneGen.classList.remove('hidden');
            paneConfig.classList.add('hidden');
            tabGen.className = "text-[9px] uppercase font-bold text-white border-b-2 border-red-600 pb-1";
            tabConfig.className = "text-[9px] uppercase font-bold text-zinc-600 hover:text-zinc-400 pb-1 transition-colors";
        };

        tabConfig.onclick = () => {
            paneGen.classList.add('hidden');
            paneConfig.classList.remove('hidden');
            tabConfig.className = "text-[9px] uppercase font-bold text-white border-b-2 border-red-600 pb-1";
            tabGen.className = "text-[9px] uppercase font-bold text-zinc-600 hover:text-zinc-400 pb-1 transition-colors";
        };

        // Gestão de Efeitos Visuais
        const body = document.body;
        const toggleScan = document.getElementById('toggleScanlines');
        const toggleFlicker = document.getElementById('toggleFlicker');
        const toggleGlow = document.getElementById('toggleGlow');
        const windows = document.querySelectorAll('.os-window');

        toggleScan.onchange = (e) => body.classList.toggle('scanlines', e.target.checked);
        toggleFlicker.onchange = (e) => body.classList.toggle('flicker', e.target.checked);
        toggleGlow.onchange = (e) => {
            windows.forEach(win => win.classList.toggle('glow-active', e.target.checked));
        };

        // Relógio
        function updateClock() {
            const now = new Date();
            document.getElementById('systemClock').innerText = now.getHours().toString().padStart(2, '0') + ":" + 
                now.getMinutes().toString().padStart(2, '0') + ":" + 
                now.getSeconds().toString().padStart(2, '0');
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Lógica do Canvas (Mantida e Estabilizada)
        const canvas = document.getElementById('tokenCanvas');
        const ctx = canvas.getContext('2d');
        const aiPrompt = document.getElementById('aiPrompt');
        const generateBtn = document.getElementById('generateBtn');
        const zoomRange = document.getElementById('zoomRange');
        const rotateRange = document.getElementById('rotateRange');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const fileUpload = document.getElementById('fileUpload');
        
        canvas.width = 1000;
        canvas.height = 1000;

        let baseImg = new Image();
        let isLoaded = false;
        let state = { x: 500, y: 500, scale: 1, rotation: 0, isDragging: false, lastX: 0, lastY: 0 };

        function init() {
            baseImg.crossOrigin = "anonymous";
            baseImg.onload = () => {
                isLoaded = true;
                autoCenterScale();
                draw();
                document.getElementById('logStatus').innerText = ">>> IMAGEM_BASE CARREGADA COM SUCESSO";
            };
            // Carregar imagem inicial se existir
            baseImg.src = "image_4b917b.png?t=" + new Date().getTime();
        }

        function autoCenterScale() {
            if (!isLoaded) return;
            const ratio = Math.min(canvas.width / baseImg.width, canvas.height / baseImg.height);
            state.scale = ratio * 0.9;
            state.x = canvas.width / 2;
            state.y = canvas.height / 2;
            draw();
        }

        fileUpload.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                baseImg.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        };

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (!isLoaded) return;
            ctx.save();
            ctx.translate(state.x, state.y);
            ctx.rotate(state.rotation * Math.PI / 180);
            ctx.scale(state.scale, state.scale);
            ctx.drawImage(baseImg, -baseImg.width / 2, -baseImg.height / 2);
            ctx.restore();
        }

        // Interações do Rato
        canvas.onmousedown = (e) => { if (isLoaded) state.isDragging = true; state.lastX = e.clientX; state.lastY = e.clientY; };
        window.onmouseup = () => state.isDragging = false;
        canvas.onmousemove = (e) => {
            if (state.isDragging && isLoaded) {
                const rect = canvas.getBoundingClientRect();
                const factor = canvas.width / rect.width;
                state.x += (e.clientX - state.lastX) * factor;
                state.y += (e.clientY - state.lastY) * factor;
                state.lastX = e.clientX; state.lastY = e.clientY;
                draw();
            }
        };

        zoomRange.oninput = (e) => { state.scale = parseFloat(e.target.value); draw(); };
        rotateRange.oninput = (e) => { state.rotation = parseInt(e.target.value); draw(); };

        async function generate() {
            const apiKey = ""; // Substituir pela chave real
            if (!aiPrompt.value.trim()) return;
            loadingOverlay.style.display = 'flex';
            generateBtn.disabled = true;

            try {
                const sketchBase64 = canvas.toDataURL('image/png').split(',')[1];
                const promptText = `CONCEPT ART: ${aiPrompt.value}. Ordem Paranormal RPG style, gritty, professional art. Background solid neutral gray.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: promptText },
                                { inlineData: { mimeType: "image/png", data: sketchBase64 } }
                            ]
                        }],
                        generationConfig: { responseModalities: ['IMAGE'] }
                    })
                });

                const result = await response.json();
                const base64 = result.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64) {
                    baseImg.src = `data:image/png;base64,${base64}`;
                }
            } catch (err) {
                alert("Erro de Manifestação: " + err.message);
            } finally {
                loadingOverlay.style.display = 'none';
                generateBtn.disabled = false;
            }
        }

        function removeBg() {
            if (!isLoaded) return;
            loadingOverlay.style.display = 'flex';
            setTimeout(() => {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                const rRef = data[0], gRef = data[1], bRef = data[2];
                for (let i = 0; i < data.length; i += 4) {
                    const diff = Math.sqrt(Math.pow(data[i]-rRef,2) + Math.pow(data[i+1]-gRef,2) + Math.pow(data[i+2]-bRef,2));
                    if (diff < 50) data[i+3] = 0;
                }
                ctx.putImageData(imageData, 0, 0);
                baseImg.src = canvas.toDataURL();
                loadingOverlay.style.display = 'none';
            }, 500);
        }

        generateBtn.onclick = generate;
        document.getElementById('removeBgBtn').onclick = removeBg;
        document.getElementById('downloadBtn').onclick = () => {
            const link = document.createElement('a');
            link.download = 'TOKEN_MANIFESTADO.png';
            link.href = canvas.toDataURL();
            link.click();
        };

        init();
    </script>
</body>
</html>
